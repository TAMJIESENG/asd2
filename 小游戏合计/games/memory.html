<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ¸¸æˆåˆé›† - è®°å¿†ç¿»ç‰Œ</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .game-container {
            padding: 30px;
            margin: 40px auto;
            max-width: 800px;
            text-align: center;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .game-controls {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .game-level {
            margin-bottom: 20px;
        }

        .game-level button {
            margin: 0 5px;
        }

        .memory-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        .level-easy {
            grid-template-columns: repeat(4, 1fr);
        }

        .level-medium {
            grid-template-columns: repeat(5, 1fr);
        }

        .level-hard {
            grid-template-columns: repeat(6, 1fr);
        }

        .card {
            aspect-ratio: 1;
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            box-shadow: var(--shadow-sm);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            background-color: var(--secondary-color);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
        }

        .card-front {
            background-color: var(--primary-color);
            color: white;
            font-size: 24px;
        }

        .card-back {
            background-color: white;
            transform: rotateY(180deg);
            font-size: 2rem;
        }

        .game-status {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .game-status.win {
            color: #10b981;
        }

        .game-status.lose {
            color: var(--secondary-color);
        }

        .game-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: white;
        }

        .game-message.show {
            display: flex;
        }

        .game-message h2 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .game-message p {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        @media (max-width: 500px) {
            .memory-board {
                gap: 8px;
            }
            
            .card-back {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <header class="main-header">
            <div class="logo">
                <h1><a href="../index.html">å°æ¸¸æˆåˆé›†</a></h1>
            </div>
            <nav class="main-nav">
                <ul id="main-nav-list">
                    <li><a href="../index.html">é¦–é¡µ</a></li>
                    <li><a href="../dashboard.html">æ§åˆ¶å°</a></li>
                    <li><a href="../leaderboard.html">æ’è¡Œæ¦œ</a></li>
                    <li><a href="../about.html">å…³äº</a></li>
                    <li><a href="../profile.html">ä¸ªäººèµ„æ–™</a></li>
                    <li><a href="#" id="logout-btn">ç™»å‡º</a></li>
                </ul>
            </nav>
        </header>
        
        <!-- æ¸¸æˆå®¹å™¨ -->
        <div class="game-container">
            <h2 class="form-title">è®°å¿†ç¿»ç‰Œ</h2>
            <p>æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„ç‰Œï¼Œè€ƒéªŒä½ çš„è®°å¿†åŠ›ï¼</p>
            
            <div class="game-level">
                <button class="btn" data-level="easy">ç®€å•</button>
                <button class="btn" data-level="medium">ä¸­ç­‰</button>
                <button class="btn" data-level="hard">å›°éš¾</button>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">ç¿»ç‰Œæ¬¡æ•°</div>
                    <div class="stat-value" id="flips">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å·²åŒ¹é…</div>
                    <div class="stat-value" id="matched">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ç”¨æ—¶</div>
                    <div class="stat-value" id="timer">0</div>
                </div>
            </div>
            
            <div class="game-controls">
                <button id="start-btn" class="btn btn-primary">å¼€å§‹æ¸¸æˆ</button>
                <button id="reset-btn" class="btn">é‡ç½®</button>
            </div>
            
            <div class="memory-board level-easy" id="memory-board">
                <!-- å¡ç‰‡å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="game-status" id="game-status"></div>
        </div>
        
        <!-- æ¸¸æˆå®Œæˆæ¶ˆæ¯ -->
        <div class="game-message" id="game-message">
            <h2>æ­å–œï¼</h2>
            <p>ä½ å·²ç»æ‰¾åˆ°äº†æ‰€æœ‰é…å¯¹ï¼</p>
            <div class="game-controls">
                <button id="play-again-btn" class="btn btn-primary">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="main-footer">
            <p>&copy; <span id="current-year"></span> å°æ¸¸æˆåˆé›† - ä¸€ä¸ªå……æ»¡ä¹è¶£çš„æ¸¸æˆå¹³å°</p>
        </footer>
    </div>

    <script>
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
        document.addEventListener('DOMContentLoaded', function() {
            if (!localStorage.getItem('isLoggedIn')) {
                window.location.href = '../login.html';
                return;
            }
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        });
        
        // è®¾ç½®å½“å‰å¹´ä»½
        document.getElementById('current-year').textContent = new Date().getFullYear();
        
        // æ³¨é”€åŠŸèƒ½
        document.getElementById('logout-btn').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('username');
            window.location.href = '../index.html';
        });
        
        // æ¸¸æˆå˜é‡
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 8;
        let flips = 0;
        let timer = 0;
        let timerInterval = null;
        let canFlip = false;
        let gameStarted = false;
        let level = 'easy';
        
        // æ¸¸æˆå›¾æ ‡ï¼Œä½¿ç”¨emojiè¡¨æƒ…
        const icons = [
            'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼',
            'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”',
            'ğŸ§', 'ğŸ¦', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—'
        ];
        
        // æ¸¸æˆéš¾åº¦è®¾ç½®
        const levels = {
            easy: { pairs: 8, columns: 4 },
            medium: { pairs: 10, columns: 5 },
            hard: { pairs: 12, columns: 6 }
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // è®¾ç½®æ¸¸æˆéš¾åº¦
            document.querySelectorAll('.game-level button').forEach(button => {
                button.addEventListener('click', function() {
                    level = this.dataset.level;
                    
                    document.querySelectorAll('.game-level button').forEach(btn => {
                        btn.classList.toggle('btn-primary', btn.dataset.level === level);
                    });
                    
                    // æ›´æ–°æ¸¸æˆæ¿å¸ƒå±€
                    const board = document.getElementById('memory-board');
                    board.className = `memory-board level-${level}`;
                    
                    // æ›´æ–°æ€»é…å¯¹æ•°
                    totalPairs = levels[level].pairs;
                    
                    if (gameStarted) {
                        resetGame();
                    }
                });
            });
            
            // é»˜è®¤é€‰æ‹©ç®€å•éš¾åº¦
            document.querySelector('[data-level="easy"]').classList.add('btn-primary');
            
            // å¼€å§‹æ¸¸æˆæŒ‰é’®
            document.getElementById('start-btn').addEventListener('click', startGame);
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('reset-btn').addEventListener('click', resetGame);
            
            // å†ç©ä¸€æ¬¡æŒ‰é’®
            document.getElementById('play-again-btn').addEventListener('click', function() {
                document.getElementById('game-message').classList.remove('show');
                resetGame();
                startGame();
            });
            
            // åˆ›å»ºåˆå§‹å¡ç‰‡
            createCards();
        }
        
        // åˆ›å»ºå¡ç‰‡
        function createCards() {
            const board = document.getElementById('memory-board');
            board.innerHTML = '';
            
            // æ ¹æ®éš¾åº¦é€‰æ‹©å›¾æ ‡æ•°é‡
            const gameIcons = icons.slice(0, totalPairs);
            
            // åˆ›å»ºé…å¯¹å¡ç‰Œ
            cards = [];
            let cardPairs = gameIcons.flatMap(icon => [icon, icon]);
            
            // éšæœºæ’åº
            shuffleArray(cardPairs);
            
            // åˆ›å»ºå¡ç‰‡DOMå…ƒç´ 
            for (let i = 0; i < cardPairs.length; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.icon = cardPairs[i];
                
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front';
                cardFront.innerHTML = '<i class="fas fa-question"></i>';
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back';
                cardBack.textContent = cardPairs[i];
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                
                card.addEventListener('click', flipCard);
                
                board.appendChild(card);
                cards.push(card);
            }
        }
        
        // æ´—ç‰Œç®—æ³•
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // ç¿»è½¬å¡ç‰‡
        function flipCard() {
            if (!canFlip || this.classList.contains('flipped') || this.classList.contains('matched')) {
                return;
            }
            
            // å¦‚æœå·²ç¿»è½¬äº†ä¸¤å¼ ç‰Œï¼Œå…ˆæ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (flippedCards.length === 2) {
                checkForMatch();
            }
            
            this.classList.add('flipped');
            flippedCards.push(this);
            
            // å¢åŠ ç¿»ç‰Œæ¬¡æ•°
            flips++;
            document.getElementById('flips').textContent = flips;
            
            // å¦‚æœå·²ç¿»è½¬ä¸¤å¼ ç‰Œï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (flippedCards.length === 2) {
                setTimeout(checkForMatch, 500);
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦åŒ¹é…
        function checkForMatch() {
            if (flippedCards.length !== 2) return;
            
            const card1 = flippedCards[0];
            const card2 = flippedCards[1];
            
            if (card1.dataset.icon === card2.dataset.icon) {
                // åŒ¹é…æˆåŠŸ
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedPairs++;
                
                // æ›´æ–°å·²åŒ¹é…æ•°é‡
                document.getElementById('matched').textContent = matchedPairs;
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
                if (matchedPairs === totalPairs) {
                    gameComplete();
                }
            } else {
                // ä¸åŒ¹é…ï¼Œç¿»å›å»
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                }, 500);
            }
            
            // æ¸…ç©ºç¿»è½¬ç‰Œæ•°ç»„
            flippedCards = [];
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameStarted) return;
            
            resetGame();
            createCards();
            
            // å…è®¸ç¿»ç‰Œ
            canFlip = true;
            gameStarted = true;
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            document.getElementById('start-btn').textContent = 'é‡æ–°å¼€å§‹';
            
            setGameStatus('', 'æ¸¸æˆå·²å¼€å§‹ï¼è®°ä½å¡ç‰‡ä½ç½®ï¼Œæ‰¾å‡ºæ‰€æœ‰é…å¯¹ã€‚');
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // åœæ­¢è®¡æ—¶å™¨
            stopTimer();
            
            // é‡ç½®æ¸¸æˆå˜é‡
            flippedCards = [];
            matchedPairs = 0;
            flips = 0;
            timer = 0;
            canFlip = false;
            gameStarted = false;
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('flips').textContent = flips;
            document.getElementById('matched').textContent = matchedPairs;
            document.getElementById('timer').textContent = timer;
            document.getElementById('start-btn').textContent = 'å¼€å§‹æ¸¸æˆ';
            
            // æ¸…ç©ºæ¸¸æˆçŠ¶æ€
            setGameStatus('', '');
            
            // åˆ›å»ºæ–°å¡ç‰‡
            createCards();
        }
        
        // æ¸¸æˆå®Œæˆ
        function gameComplete() {
            stopTimer();
            gameStarted = false;
            canFlip = false;
            
            // ä¿å­˜æ¸¸æˆè®°å½•
            saveGameResult();
            
            // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
            document.getElementById('game-message').classList.add('show');
            
            setGameStatus('win', `æ­å–œï¼ä½ å·²æ‰¾åˆ°æ‰€æœ‰é…å¯¹ï¼Œç”¨äº†${flips}æ¬¡ç¿»ç‰Œå’Œ${timer}ç§’æ—¶é—´ã€‚`);
        }
        
        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            stopTimer();
            timer = 0;
            document.getElementById('timer').textContent = timer;
            
            timerInterval = setInterval(function() {
                timer++;
                document.getElementById('timer').textContent = timer;
            }, 1000);
        }
        
        // åœæ­¢è®¡æ—¶å™¨
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        // è®¾ç½®æ¸¸æˆçŠ¶æ€
        function setGameStatus(type, message) {
            const status = document.getElementById('game-status');
            status.textContent = message;
            status.className = 'game-status';
            
            if (type) {
                status.classList.add(type);
            }
        }
        
        // ä¿å­˜æ¸¸æˆè®°å½•
        function saveGameResult() {
            console.log(`æ¸¸æˆå®Œæˆï¼šç”¨äº†${flips}æ¬¡ç¿»ç‰Œå’Œ${timer}ç§’æ—¶é—´`);
            
            // æ›´æ–°æœ¬åœ°ç»Ÿè®¡æ•°æ®
            const gameStats = JSON.parse(localStorage.getItem('gameStats') || '{}');
            
            if (!gameStats.memory) {
                gameStats.memory = {
                    gamesPlayed: 0,
                    totalFlips: 0,
                    bestFlips: Infinity,
                    bestTime: Infinity
                };
            }
            
            gameStats.memory.gamesPlayed++;
            gameStats.memory.totalFlips += flips;
            
            // æ›´æ–°æœ€ä½³è®°å½•
            if (flips < gameStats.memory.bestFlips || 
                (flips === gameStats.memory.bestFlips && timer < gameStats.memory.bestTime)) {
                gameStats.memory.bestFlips = flips;
                gameStats.memory.bestTime = timer;
            }
            
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }
    </script>
</body>
</html> 